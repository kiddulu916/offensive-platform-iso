import pytest
from app.workflows.processors.exploit_lookup import ExploitLookupProcessor

def test_exploit_lookup_parse_service_version():
    """Test parsing service version strings"""
    processor = ExploitLookupProcessor()

    service = "Apache httpd 2.4.49"
    parsed = processor._parse_service_version(service)

    assert parsed["product"] == "Apache httpd"
    assert parsed["version"] == "2.4.49"

def test_exploit_lookup_filter_safe_exploits():
    """Test filtering out dangerous exploit types"""
    processor = ExploitLookupProcessor()

    exploits = [
        {"id": "CVE-2021-1234", "type": "remote code execution", "description": "RCE vuln"},
        {"id": "CVE-2021-5678", "type": "denial of service", "description": "DoS vuln"},
        {"id": "CVE-2021-9999", "type": "social engineering", "description": "Phishing"},
    ]

    safe = processor._filter_safe_exploits(exploits)

    assert len(safe) == 1
    assert safe[0]["id"] == "CVE-2021-1234"
